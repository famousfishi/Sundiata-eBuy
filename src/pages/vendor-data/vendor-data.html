<!--
  Generated template for the VendorDataPage page.

  See http://ionicframework.com/docs/components/#navigation for more info on
  Ionic pages and navigation.
-->
<ion-content padding>
  <ion-segment [(ngModel)]="dataMenu">
    <ion-segment-button value="fresh">New Transaction</ion-segment-button>
    <ion-segment-button value="history">History</ion-segment-button>
  </ion-segment>
  <div [ngSwitch]="dataMenu">
    <ion-list *ngSwitchCase="'fresh'" no-lines (swipe)="SwipeEvent($event, 1)">
      <form #form="ngForm" name="form">
        <ion-item>
          <ion-label floating>Network</ion-label>
          <ion-select name="network" [(ngModel)]="transaction.network" #network (ionChange)="ChangeNetwork(network.value, network.text)">
            <ion-option [value]="s.id" *ngFor= "let s of dataNetworks">{{s.name}}</ion-option>
          </ion-select>
        </ion-item>
        <ion-item *ngIf="hasDataBundles">
          <ion-label floating>Data Bundle</ion-label>
          <ion-select name="bundle" [(ngModel)]="transaction.bundleID" #bundle (ionChange)="ChangeDataBundle(bundle.value, bundle.text)">
            <ion-option [value]="s.id" *ngFor= "let s of dataBundles">{{s.name}}</ion-option>
          </ion-select>
        </ion-item>
        <ion-item>
          <ion-label floating>Phone / Device No.</ion-label>
          <ion-input type="number" name="phone" [(ngModel)]="transaction.phone"  required></ion-input>
        </ion-item>
        <ion-item>
          <ion-label floating>E-mail</ion-label>
          <ion-input type="email" name="email" [(ngModel)]="transaction.email"  required></ion-input>
        </ion-item>
        <ion-item>
          <br><br>
          <button type="submit" ion-button large block [disabled]="form.invalid || btnDisabled">Purchase Data</button>
        </ion-item>
      </form>
    </ion-list>
    <ion-list *ngSwitchCase="'history'" (swipe)="SwipeEvent($event, 2)">
      <ion-refresher (ionRefresh)="RefreshPage($event)">
        <ion-refresher-content
          pullingIcon="arrow-dropdown"
          pullingText="Pull to refresh"
          refreshingSpinner="circles"
          refreshingText="Refreshing..."
        ></ion-refresher-content>
      </ion-refresher>
      <div *ngIf="transactionsHistory && transactionsHistory.status && transactionsHistory.total > 0">
        <ion-item *ngFor="let a of presentHistory">
          <h2>Phone / device No.: {{ a.phone }}</h2>
          <h3>Transaction ID: {{ a.transaction_id }}</h3>
          <p>Amount: {{ a.amount }} | Network: {{ a.service.name }}</p>
          <ion-badge *ngIf="a.status == 0" color="warning">Pending</ion-badge>
          <ion-badge *ngIf="a.status == 1" color="primary">In-progress</ion-badge>
          <ion-badge *ngIf="a.status == 2" color="success">Fulfilled</ion-badge>
          <ion-badge *ngIf="a.status == 3" color="danger">Failed</ion-badge>
          <ion-badge *ngIf="a.status == 4" color="dark">Re-try</ion-badge>
        </ion-item>
        <ion-infinite-scroll (ionInfinite)="DoInfiniteScroll($event)" *ngIf="pagination.PageCount > 1 && pagination.PageItemCount(historyPage+1) !== -1">
          <ion-infinite-scroll-content></ion-infinite-scroll-content>
        </ion-infinite-scroll>
      </div>
      <div *ngIf="!transactionsHistory || transactionsHistory.total <= 0">
        <ion-grid>
          <ion-row>
            <ion-col col-12>
              <img src="../../assets/imgs/page-empty-page.jpg">
            </ion-col>
          </ion-row>
        </ion-grid>
      </div>
    </ion-list>
  </div>
</ion-content>
